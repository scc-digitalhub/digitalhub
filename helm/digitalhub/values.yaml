global:
  cleanup:
    persistentVolumeClaim: false
    ingress: false
  service:
    type: &serviceType "NodePort"
  registry:
    url: 192.168.49.2:30150
    username: ""
    password: ""
    email: ""
    secretName: ""
  basicAuth:
    enabled: false
    username: ""
    password: ""
    secretName: ""
  nuclio:
    dashboard:
      nodePort: 30050
  externalHostAddress: &globalExternalUrl "192.168.49.2"
  securityContext:
      runAsNonRoot: true
      allowPrivilegeEscalation: false
      capabilities:
        drop:
        - ALL

docker-registry: 
  enabled: true
  fullnameOverride: digitalhub-docker-registry
  className: nginx
  service:
    type: *serviceType
    nodePort: 30150
  ingress:
    enabled: false
    path: /
    hosts:
      - registry.digitalhub.test
    labels: 
  persistence:
    accessMode: 'ReadWriteOnce'
    enabled: true
    size: 128Gi
  updateStrategy:
    type: Recreate

mlrun-ce: 
  enabled: true
  nuclio:
    fullnameOverride: nuclio
    controller:
      enabled: true
    dashboard:
      enabled: true
      containerBuilderKind: kaniko
      kaniko:
        insecurePushRegistry: true
        insecurePullRegistry: true
    rbac:
      create: true
      crdAccessMode: namespaced
    crd:
      create: true
    platform:
      logger:
        sinks:
          myStdoutLoggerSink:
            kind: stdout
            attributes:
              encoding: console
              timeFieldName: time
              timeFieldEncoding: iso8601
        system:
        - level: debug
          sink: myStdoutLoggerSink
        functions:
        - level: debug
          sink: myStdoutLoggerSink
  mlrun:
    storage: filesystem
    fullnameOverride: mlrun
    nuclio:
      mode: enabled
    rbac:
      create: true
    v3io:
      enabled: false
    api:
      fullnameOverride: mlrun-api
      ingress:
        enabled: false
      volumes:
        storageOverride:
          persistentVolumeClaim:
            claimName: mlrun-api-pvc
      persistence:
        enabled: true
        existingClaim:
        storageClass:
        accessMode: "ReadWriteOnce"
        size: "8Gi"
        annotations:
          helm.sh/resource-policy: "keep"
      envFrom:
        - configMapRef:
            name: mlrun-common-env
        - configMapRef:
            name: mlrun-pipelines-config
            optional: true
        - configMapRef:
            name: mlrun-spark-config
            optional: true
        - configMapRef:
            name: mlrun-override-env
            optional: true
      extraPersistentVolumeMounts: ~
    ui:
      fullnameOverride: mlrun-ui
      ingress:
        enabled: false
    db:
      name: db
      fullnameOverride: mlrun-db
      securityContext: 
        runAsUser: 999
      podSecurityContext:
        runAsUser: 999
        fsGroup: 999    
      volumes:
        storageOverride:
          persistentVolumeClaim:
            claimName: mlrun-db-pvc
      persistence:
        enabled: true
        existingClaim:
        storageClass:
        accessMode: "ReadWriteOnce"
        size: "8Gi"
        annotations:
          helm.sh/resource-policy: "keep"
    httpDB:
      dbType: mysql
      dirPath: "/mlrun/db"
      dsn: mysql+pymysql://root@mlrun-db:3306/mlrun
      oldDsn: sqlite:////mlrun/db/mlrun.db?check_same_thread=false
    ce:
      mode: full
  jupyterNotebook:
    enabled: false
  mpi-operator:
    fullnameOverride: mpi-operator
    crd:
      create: true
    rbac:
      clusterResources:
        create: true
      namespaced:
        create: true
    deployment:
      create: true
  minio:
    enabled: true
    rootUser: minio
    rootPassword: minio123
    mode: standalone
    replicas: 1
    resources:
      requests:
        memory: 0.5Gi
    ingress:
      enabled: false
      ingressClassName: "nginx"
      path: /
      hosts:
        - minio-api.digitalhub.test
    consoleIngress:
      enabled: false
      ingressClassName: "nginx"
      path: /
      hosts:
        - minio.digitalhub.test
    persistence:
      enabled: true
      size: 128Gi
    fullnameOverride: minio
    buckets:
      - name: datalake
        policy: none
        purge: false
  spark-operator:
    enabled: true
    fullnameOverride: spark-operator
    webhook:
      enable: true
    serviceAccounts:
      spark:
        name: "sparkapp"
  pipelines:
    enabled: true
    name: pipelines
    persistence:
      enabled: true
      existingClaim:
      storageClass:
      accessMode: "ReadWriteOnce"
      size: "128Gi"
      annotations:
        helm.sh/resource-policy: "keep"
    db:
      username: root
    minio:
      enabled: true
      accessKey: "minio"
      secretKey: "minio123"
      endpoint: "minio"
      endpointPort: "9000"
      bucket: "datalake"
  kube-prometheus-stack:
    enabled: false  

coder: 
  enabled: true
  username: test
  password: Test12456@!
  email: test@digitalhub.test
  customCoderTemplates:
    - name: jupyter
      nodePort: "30040"
      iconUrl: https://upload.wikimedia.org/wikipedia/commons/thumb/3/38/Jupyter_logo.svg/1200px-Jupyter_logo.svg.png
    - name: dremio
      nodePort: "30120"
      iconUrl: https://cdn.icon-icons.com/icons2/2699/PNG/512/dremio_logo_icon_168234.png
    - name: sqlpad
      nodePort: "30140"
      iconUrl: https://i.ibb.co/TrBDsZM/sqlpad.png
    - name: grafana
      nodePort: "30130"
      iconUrl: https://cdn.icon-icons.com/icons2/2699/PNG/512/grafana_logo_icon_171048.png
    - name: dashboard
      nodePort: "30110"
      iconUrl: https://svgshare.com/i/u5R.svg
  coder:
    image:
      tag: v2.6.0
    env:
      - name: CODER_PG_USERNAME
        valueFrom:
          secretKeyRef:
            name: coder.coder-postgres-cluster.credentials.postgresql.acid.zalan.do
            key: username
      - name: CODER_PG_PASSWORD
        valueFrom:
          secretKeyRef:
            name: coder.coder-postgres-cluster.credentials.postgresql.acid.zalan.do
            key: password
      - name: CODER_PG_CONNECTION_URL
        value: "postgres://$(CODER_PG_USERNAME):$(CODER_PG_PASSWORD)@coder-postgres-cluster:5432/coder"
    ingress:
      enable: false
    service:
      type: *serviceType
      httpNodePort: "30170"

postgres-operator: 
  enabled: true
  digitalhubDatabase:
    volume:
      size: 256Gi
    resources:
      requests:
        cpu: 1000m
        memory: 1000Mi
      limits:
        cpu: "4"
        memory: 8Gi

ext-postgres-operator:
  enabled: true
  postgres:
    host: database-postgres-cluster
    user: ""
    password: ""
    uri_args: ""
    cloud_provider: ""
    default_database: "postgres"
  postgresCredsExistingSecrets:
    username:
      secretName: "digitalhubadmin.database-postgres-cluster.credentials.postgresql.acid.zalan.do" 
      secretKey: "username"
    password:
      secretName: "digitalhubadmin.database-postgres-cluster.credentials.postgresql.acid.zalan.do" 
      secretKey: "password"

postgrest-operator:
  enabled: true
  postgres:
    host: database-postgres-cluster
    port: 5432
    uri_args: "sslmode=disable"
    default_database: "digitalhub"
    postgrest_service_type: NodePort
  postgresCredsExistingSecrets:
    username:
      secretName: "digitalhub-owner-user.database-postgres-cluster.credentials.postgresql.acid.zalan.do" 
      secretKey: "username"
    password:
      secretName: "digitalhub-owner-user.database-postgres-cluster.credentials.postgresql.acid.zalan.do" 
      secretKey: "password"

core:
  enabled: true
  minio:
    bucketName: datalake
    endpoint: "minio"
    endpointPort: "9000"
  service:
    type: *serviceType
    httpNodePort: "30180"
  postgres:
    host: database-postgres-cluster
    database: digitalhub
    port: "5432"
    schema: public
  config:
    rootUser: minio
    rootPassword: minio123
  krm:
    port: "8080"

custom-resource-manager:
  enabled: true
  service:
    type: *serviceType
    httpNodePort: "30220"

dremio-rest-server-operator:
  enabled: true

apigw-operator:
  enabled: true
  
grafana:
  enabled: true
  adminPassword: digitalhub-test
  service:
    type: NodePort
    nodePort: 30210
  datasources:
    datasources.yaml:
      apiVersion: 1
      datasources:
        - name: Postgres
          type: postgres
          url: database-postgres-cluster:5432
          user: ${username}
          secureJsonData:
            password: ${password}
          jsonData:
            database: digitalhub
            sslmode: 'require' # disable/require/verify-ca/verify-full
            maxOpenConns: 100 # Grafana v5.4+
            maxIdleConns: 100 # Grafana v5.4+
            maxIdleConnsAuto: true # Grafana v9.5.1+
            connMaxLifetime: 14400 # Grafana v5.4+
            postgresVersion: 1500 # 903=9.3, 904=9.4, 905=9.5, 906=9.6, 1000=10
            timescaledb: false
  plugins:
    - https://github.com/scc-digitalhub/grafana-dremio-datasource-plugin/raw/master/releases/digital-hub-dremio-1.1.1.zip;digital-hub-dremio
  envFromSecret: digitalhub-reader-user.database-postgres-cluster.credentials.postgresql.acid.zalan.do
  env:
    GF_PLUGINS_ALLOW_LOADING_UNSIGNED_PLUGINS: "digital-hub-dremio"

jobs:
  delete:
    securityContext:
      readOnlyRootFilesystem: true

rabbitmq-cluster-operator:
  enabled: true